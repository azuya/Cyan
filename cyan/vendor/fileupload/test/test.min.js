/*
 * jQuery File Upload Plugin Test 7.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *//*jslint nomen: true, unparam: true *//*global $, QUnit, window, document, expect, module, test, asyncTest, start, ok, strictEqual, notStrictEqual */$(function(){"use strict";QUnit.done=function(){var e=$("#fileupload").prop("action");$.getJSON(e,function(t){$.each(t.files,function(t,n){$.ajax({url:e+"?file="+encodeURIComponent(n.name),type:"DELETE"})})})};var e={setup:function(){$.widget("blueimp.fileupload",window.testBasicWidget,{})},teardown:function(){$(document).unbind()}},t={setup:function(){$.widget("blueimp.fileupload",window.testUIWidget,{})},teardown:function(){$(document).unbind()}};module("Initialization",e);test("Widget initialization",function(){var e=$("#fileupload").fileupload();ok(e.data("blueimp-fileupload")||e.data("fileupload"))});test("Data attribute options",function(){$("#fileupload").attr("data-url","http://example.org");$("#fileupload").fileupload();strictEqual($("#fileupload").fileupload("option","url"),"http://example.org")});test("File input initialization",function(){var e=$("#fileupload").fileupload();ok(e.fileupload("option","fileInput").length,"File input field inside of the widget");ok(e.fileupload("option","fileInput").length,"Widget element as file input field")});test("Drop zone initialization",function(){ok($("#fileupload").fileupload().fileupload("option","dropZone").length)});test("Paste zone initialization",function(){ok($("#fileupload").fileupload().fileupload("option","pasteZone").length)});test("Event listeners initialization",function(){expect($.support.xhrFormDataFileUpload?4:1);var e={originalEvent:{}},t=$("#fileupload").fileupload({dragover:function(){ok(!0,"Triggers dragover callback");return!1},drop:function(){ok(!0,"Triggers drop callback");return!1},paste:function(){ok(!0,"Triggers paste callback");return!1},change:function(){ok(!0,"Triggers change callback");return!1}}),n=t.fileupload("option","fileInput"),r=t.fileupload("option","dropZone"),i=t.fileupload("option","pasteZone");n.trigger($.Event("change",e));r.trigger($.Event("dragover",e));r.trigger($.Event("drop",e));i.trigger($.Event("paste",e))});module("API",e);test("destroy",function(){expect(4);var e={originalEvent:{}},t={dragover:function(){ok(!0,"Triggers dragover callback");return!1},drop:function(){ok(!0,"Triggers drop callback");return!1},paste:function(){ok(!0,"Triggers paste callback");return!1},change:function(){ok(!0,"Triggers change callback");return!1}},n=$("#fileupload").fileupload(t),r=n.fileupload("option","fileInput"),i=n.fileupload("option","dropZone"),s=n.fileupload("option","pasteZone");i.bind("dragover",t.dragover);i.bind("drop",t.drop);s.bind("paste",t.paste);r.bind("change",t.change);n.fileupload("destroy");r.trigger($.Event("change",e));i.trigger($.Event("dragover",e));i.trigger($.Event("drop",e));s.trigger($.Event("paste",e))});test("disable/enable",function(){expect($.support.xhrFormDataFileUpload?4:1);var e={originalEvent:{}},t=$("#fileupload").fileupload({dragover:function(){ok(!0,"Triggers dragover callback");return!1},drop:function(){ok(!0,"Triggers drop callback");return!1},paste:function(){ok(!0,"Triggers paste callback");return!1},change:function(){ok(!0,"Triggers change callback");return!1}}),n=t.fileupload("option","fileInput"),r=t.fileupload("option","dropZone"),i=t.fileupload("option","pasteZone");t.fileupload("disable");n.trigger($.Event("change",e));r.trigger($.Event("dragover",e));r.trigger($.Event("drop",e));i.trigger($.Event("paste",e));t.fileupload("enable");n.trigger($.Event("change",e));r.trigger($.Event("dragover",e));r.trigger($.Event("drop",e));i.trigger($.Event("paste",e))});test("option",function(){expect($.support.xhrFormDataFileUpload?10:7);var e={originalEvent:{}},t=$("#fileupload").fileupload({dragover:function(){ok(!0,"Triggers dragover callback");return!1},drop:function(){ok(!0,"Triggers drop callback");return!1},paste:function(){ok(!0,"Triggers paste callback");return!1},change:function(){ok(!0,"Triggers change callback");return!1}}),n=t.fileupload("option","fileInput"),r=t.fileupload("option","dropZone"),i=t.fileupload("option","pasteZone");t.fileupload("option","fileInput",null);t.fileupload("option","dropZone",null);t.fileupload("option","pasteZone",null);n.trigger($.Event("change",e));r.trigger($.Event("dragover",e));r.trigger($.Event("drop",e));i.trigger($.Event("paste",e));t.fileupload("option","dropZone","body");strictEqual(t.fileupload("option","dropZone")[0],document.body,"Allow a query string as parameter for the dropZone option");t.fileupload("option","dropZone",document);strictEqual(t.fileupload("option","dropZone")[0],document,"Allow a document element as parameter for the dropZone option");t.fileupload("option","pasteZone","body");strictEqual(t.fileupload("option","pasteZone")[0],document.body,"Allow a query string as parameter for the pasteZone option");t.fileupload("option","pasteZone",document);strictEqual(t.fileupload("option","pasteZone")[0],document,"Allow a document element as parameter for the pasteZone option");t.fileupload("option","fileInput",":file");strictEqual(t.fileupload("option","fileInput")[0],$(":file")[0],"Allow a query string as parameter for the fileInput option");t.fileupload("option","fileInput",$(":file")[0]);strictEqual(t.fileupload("option","fileInput")[0],$(":file")[0],"Allow a document element as parameter for the fileInput option");t.fileupload("option","fileInput",n);t.fileupload("option","dropZone",r);t.fileupload("option","pasteZone",i);n.trigger($.Event("change",e));r.trigger($.Event("dragover",e));r.trigger($.Event("drop",e));i.trigger($.Event("paste",e))});asyncTest("add",function(){expect(2);var e={files:[{name:"test"}]};$("#fileupload").fileupload({add:function(t,n){strictEqual(n.files[0].name,e.files[0].name,"Triggers add callback")}}).fileupload("add",e).fileupload("option","add",function(e,t){t.submit().complete(function(){ok(!0,"data.submit() Returns a jqXHR object");start()})}).fileupload("add",e)});asyncTest("send",function(){expect(3);var e={files:[{name:"test"}]};$("#fileupload").fileupload({send:function(e,t){strictEqual(t.files[0].name,"test","Triggers send callback")}}).fileupload("send",e).fail(function(){ok(!0,"Allows to abort the request")}).complete(function(){ok(!0,"Returns a jqXHR object");start()}).abort()});module("Callbacks",e);asyncTest("add",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({add:function(e,t){ok(!0,"Triggers add callback");start()}}).fileupload("add",e)});asyncTest("submit",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({submit:function(e,t){ok(!0,"Triggers submit callback");start();return!1}}).fileupload("add",e)});asyncTest("send",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({send:function(e,t){ok(!0,"Triggers send callback");start();return!1}}).fileupload("send",e)});asyncTest("done",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({done:function(e,t){ok(!0,"Triggers done callback");start()}}).fileupload("send",e)});asyncTest("fail",function(){expect(1);var e={files:[{name:"test"}]},t=$("#fileupload").fileupload({url:"404",fail:function(e,t){ok(!0,"Triggers fail callback");start()}});(t.data("blueimp-fileupload")||t.data("fileupload"))._isXHRUpload=function(){return!0};t.fileupload("send",e)});asyncTest("always",function(){expect(2);var e={files:[{name:"test"}]},t=0,n=$("#fileupload").fileupload({always:function(e,n){ok(!0,"Triggers always callback");t===1?start():t+=1}});(n.data("blueimp-fileupload")||n.data("fileupload"))._isXHRUpload=function(){return!0};n.fileupload("add",e).fileupload("option","url","404").fileupload("add",e)});asyncTest("progress",function(){expect(1);var e={files:[{name:"test"}]},t=0;$("#fileupload").fileupload({forceIframeTransport:!0,progress:function(e,n){ok(!0,"Triggers progress callback");t===0?start():t+=1}}).fileupload("send",e)});asyncTest("progressall",function(){expect(1);var e={files:[{name:"test"}]},t=0;$("#fileupload").fileupload({forceIframeTransport:!0,progressall:function(e,n){ok(!0,"Triggers progressall callback");t===0?start():t+=1}}).fileupload("send",e)});asyncTest("start",function(){expect(1);var e={files:[{name:"1"},{name:"2"}]},t=0;$("#fileupload").fileupload({send:function(e,n){t+=1},start:function(e,n){ok(!t,"Triggers start callback before uploads");start()}}).fileupload("send",e)});asyncTest("stop",function(){expect(1);var e={files:[{name:"1"},{name:"2"}]},t=0;$("#fileupload").fileupload({send:function(e,n){t+=1},always:function(e,n){t-=1},stop:function(e,n){ok(!t,"Triggers stop callback after uploads");start()}}).fileupload("send",e)});test("change",function(){var e=$("#fileupload").fileupload(),t=e.data("blueimp-fileupload")||e.data("fileupload"),n=e.fileupload("option","fileInput");expect(2);e.fileupload({change:function(e,t){ok(!0,"Triggers change callback");strictEqual(t.files.length,0,"Returns empty files list")},add:$.noop});t._onChange({data:{fileupload:t},target:n[0]})});test("paste",function(){var e=$("#fileupload").fileupload(),t=e.data("blueimp-fileupload")||e.data("fileupload");expect(1);e.fileupload({paste:function(e,t){ok(!0,"Triggers paste callback")},add:$.noop});t._onPaste({data:{fileupload:t},originalEvent:{clipboardData:{}},preventDefault:$.noop})});test("drop",function(){var e=$("#fileupload").fileupload(),t=e.data("blueimp-fileupload")||e.data("fileupload");expect(1);e.fileupload({drop:function(e,t){ok(!0,"Triggers drop callback")},add:$.noop});t._onDrop({data:{fileupload:t},originalEvent:{dataTransfer:{}},preventDefault:$.noop})});test("dragover",function(){var e=$("#fileupload").fileupload(),t=e.data("blueimp-fileupload")||e.data("fileupload");expect(1);e.fileupload({dragover:function(e,t){ok(!0,"Triggers dragover callback")},add:$.noop});t._onDragOver({data:{fileupload:t},originalEvent:{dataTransfer:{}},preventDefault:$.noop})});module("Options",e);test("paramName",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({paramName:null,send:function(e,t){strictEqual(t.paramName[0],t.fileInput.prop("name"),"Takes paramName from file input field if not set");return!1}}).fileupload("send",e)});test("url",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({url:null,send:function(e,t){strictEqual(t.url,$(t.fileInput.prop("form")).prop("action"),"Takes url from form action if not set");return!1}}).fileupload("send",e)});test("type",function(){expect(2);var e={files:[{name:"test"}]};$("#fileupload").fileupload({type:null,send:function(e,t){strictEqual(t.type,"POST",'Request type is "POST" if not set to "PUT"');return!1}}).fileupload("send",e);$("#fileupload").fileupload({type:"PUT",send:function(e,t){strictEqual(t.type,"PUT",'Request type is "PUT" if set to "PUT"');return!1}}).fileupload("send",e)});test("replaceFileInput",function(){var e=$("#fileupload").fileupload(),t=e.data("blueimp-fileupload")||e.data("fileupload"),n=e.fileupload("option","fileInput"),r=n[0];expect(2);e.fileupload({replaceFileInput:!1,change:function(t,n){strictEqual(e.fileupload("option","fileInput")[0],r,"Keeps file input with replaceFileInput: false")},add:$.noop});t._onChange({data:{fileupload:t},target:n[0]});e.fileupload({replaceFileInput:!0,change:function(t,n){notStrictEqual(e.fileupload("option","fileInput")[0],r,"Replaces file input with replaceFileInput: true")},add:$.noop});t._onChange({data:{fileupload:t},target:n[0]})});asyncTest("forceIframeTransport",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({forceIframeTransport:!0,done:function(e,t){strictEqual(t.dataType.substr(0,6),"iframe","Iframe Transport is used");start()}}).fileupload("send",e)});test("singleFileUploads",function(){expect(3);var e=$("#fileupload").fileupload(),t={files:[{name:"1"},{name:"2"}]},n=1;(e.data("blueimp-fileupload")||e.data("fileupload"))._isXHRUpload=function(){return!0};$("#fileupload").fileupload({singleFileUploads:!0,add:function(e,t){ok(!0,"Triggers callback number "+n.toString());n+=1}}).fileupload("add",t).fileupload("option","singleFileUploads",!1).fileupload("add",t)});test("limitMultiFileUploads",function(){expect(3);var e=$("#fileupload").fileupload(),t={files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"}]},n=1;(e.data("blueimp-fileupload")||e.data("fileupload"))._isXHRUpload=function(){return!0};$("#fileupload").fileupload({singleFileUploads:!1,limitMultiFileUploads:2,add:function(e,t){ok(!0,"Triggers callback number "+n.toString());n+=1}}).fileupload("add",t)});asyncTest("sequentialUploads",function(){expect(6);var e={files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"},{name:"6"}]},t=0,n=0,r=0,i=$("#fileupload").fileupload({sequentialUploads:!0,add:function(e,n){t+=1;t===4?n.submit().abort():n.submit()},send:function(e,t){n+=1},done:function(e,t){r+=1;strictEqual(n,r,"upload in order")},fail:function(e,t){strictEqual(t.errorThrown,"abort","upload aborted")},stop:function(e){start()}});(i.data("blueimp-fileupload")||i.data("fileupload"))._isXHRUpload=function(){return!0};i.fileupload("add",e)});asyncTest("limitConcurrentUploads",function(){expect(12);var e={files:[{name:"1"},{name:"2"},{name:"3"},{name:"4"},{name:"5"},{name:"6"},{name:"7"},{name:"8"},{name:"9"},{name:"10"},{name:"11"},{name:"12"}]},t=0,n=0,r=0,i=$("#fileupload").fileupload({limitConcurrentUploads:3,add:function(e,n){t+=1;t===4?n.submit().abort():n.submit()},send:function(e,t){n+=1},done:function(e,t){r+=1;ok(n-r<3)},fail:function(e,t){strictEqual(t.errorThrown,"abort","upload aborted")},stop:function(e){start()}});(i.data("blueimp-fileupload")||i.data("fileupload"))._isXHRUpload=function(){return!0};i.fileupload("add",e)});$.support.xhrFileUpload&&asyncTest("multipart",function(){expect(2);var e={files:[{name:"test.png",size:123,type:"image/png"}]},t=$("#fileupload").fileupload({multipart:!1,always:function(t,n){strictEqual(n.contentType,e.files[0].type,"non-multipart upload sets file type as contentType");strictEqual(n.headers["Content-Disposition"],'attachment; filename="'+e.files[0].name+'"',"non-multipart upload sets Content-Disposition header");start()}});t.fileupload("send",e)});module("UI Initialization",t);test("Widget initialization",function(){var e=$("#fileupload").fileupload();ok(e.data("blueimp-fileupload")||e.data("fileupload"));ok($("#fileupload").fileupload("option","uploadTemplate").length,"Initialized upload template");ok($("#fileupload").fileupload("option","downloadTemplate").length,"Initialized download template")});test("Buttonbar event listeners",function(){var e=$("#fileupload .fileupload-buttonbar"),t=[{name:"test"}];expect(4);$("#fileupload").fileupload({send:function(e,t){ok(!0,"Started file upload via global start button")},fail:function(e,t){ok(!0,"Canceled file upload via global cancel button");t.context.remove()},destroy:function(e,t){ok(!0,"Delete action called via global delete button")}});$("#fileupload").fileupload("add",{files:t});e.find(".cancel").click();$("#fileupload").fileupload("add",{files:t});e.find(".start").click();e.find(".cancel").click();($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload(t).appendTo($("#fileupload .files")).show().find(".delete input").click();e.find(".delete").click()});module("UI API",t);test("destroy",function(){var e=$("#fileupload .fileupload-buttonbar"),t=[{name:"test"}];expect(1);$("#fileupload").fileupload({send:function(e,t){ok(!0,"This test should not run");return!1}}).fileupload("add",{files:t}).fileupload("destroy");e.find(".start").click(function(){ok(!0,"Clicked global start button");return!1}).click()});test("disable/enable",function(){var e=$("#fileupload .fileupload-buttonbar");$("#fileupload").fileupload();$("#fileupload").fileupload("disable");strictEqual(e.find("input[type=file], button").not(":disabled").length,0,"Disables the buttonbar buttons");$("#fileupload").fileupload("enable");strictEqual(e.find("input[type=file], button").not(":disabled").length,4,"Enables the buttonbar buttons")});module("UI Callbacks",t);test("destroy",function(){expect(3);$("#fileupload").fileupload({destroy:function(e,t){ok(!0,"Triggers destroy callback");strictEqual(t.url,"test","Passes over deletion url parameter");strictEqual(t.type,"DELETE","Passes over deletion request type parameter")}});($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload([{name:"test",delete_url:"test",delete_type:"DELETE"}]).appendTo($("#fileupload .files")).show().find(".delete input").click();$("#fileupload .fileupload-buttonbar .delete").click()});asyncTest("added",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({added:function(t,n){start();strictEqual(n.files[0].name,e.files[0].name,"Triggers added callback")},send:function(){return!1}}).fileupload("add",e)});asyncTest("started",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({started:function(e){start();ok("Triggers started callback");return!1},sent:function(e,t){return!1}}).fileupload("send",e)});asyncTest("sent",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({sent:function(t,n){start();strictEqual(n.files[0].name,e.files[0].name,"Triggers sent callback");return!1}}).fileupload("send",e)});asyncTest("completed",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({completed:function(e,t){start();ok("Triggers completed callback");return!1}}).fileupload("send",e)});asyncTest("failed",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({failed:function(e,t){start();ok("Triggers failed callback");return!1}}).fileupload("send",e).abort()});asyncTest("stopped",function(){expect(1);var e={files:[{name:"test"}]};$("#fileupload").fileupload({stopped:function(e,t){start();ok("Triggers stopped callback");return!1}}).fileupload("send",e)});asyncTest("destroyed",function(){expect(1);$("#fileupload").fileupload({destroyed:function(e,t){start();ok(!0,"Triggers destroyed callback")}});($("#fileupload").data("blueimp-fileupload")||$("#fileupload").data("fileupload"))._renderDownload([{name:"test",delete_url:"test",delete_type:"DELETE"}]).appendTo($("#fileupload .files")).show().find(".delete input").click();$("#fileupload .fileupload-buttonbar .delete").click()});module("UI Options",t);test("autoUpload",function(){expect(1);$("#fileupload").fileupload({autoUpload:!0,send:function(e,t){ok(!0,"Started file upload automatically");return!1}}).fileupload("add",{files:[{name:"test"}]}).fileupload("option","autoUpload",!1).fileupload("add",{files:[{name:"test"}]})});test("maxNumberOfFiles",function(){expect(4);var e=0,t=0;$("#fileupload").fileupload({autoUpload:!0,maxNumberOfFiles:1,singleFileUploads:!1,send:function(n,r){strictEqual(t+=1,e)},progress:$.noop,progressall:$.noop,done:$.noop,stop:$.noop}).fileupload("add",{files:[{name:e+=1}]}).fileupload("add",{files:[{name:"test"}]}).fileupload("option","maxNumberOfFiles",1).fileupload("add",{files:[{name:1},{name:2}]}).fileupload({maxNumberOfFiles:1,send:function(n,r){strictEqual(t+=1,e);return!1}}).fileupload("add",{files:[{name:e+=1}]}).fileupload("add",{files:[{name:e+=1}]}).fileupload({maxNumberOfFiles:0,send:function(e,t){ok(!$.blueimp.fileupload.prototype.options.send.call(this,e,t));return!1}}).fileupload("send",{files:[{name:"test"}]})});test("maxFileSize",function(){expect(3);var e=0,t=0;$("#fileupload").fileupload({autoUpload:!0,maxFileSize:1e3,send:function(n,r){strictEqual(t+=1,e);return!1}}).fileupload("add",{files:[{name:e+=1}]}).fileupload("add",{files:[{name:e+=1,size:999}]}).fileupload("add",{files:[{name:"test",size:1001}]}).fileupload({send:function(e,t){ok(!$.blueimp.fileupload.prototype.options.send.call(this,e,t));return!1}}).fileupload("send",{files:[{name:"test",size:1001}]})});test("minFileSize",function(){expect(3);var e=0,t=0;$("#fileupload").fileupload({autoUpload:!0,minFileSize:1e3,send:function(n,r){strictEqual(t+=1,e);return!1}}).fileupload("add",{files:[{name:e+=1}]}).fileupload("add",{files:[{name:e+=1,size:1001}]}).fileupload("add",{files:[{name:"test",size:999}]}).fileupload({send:function(e,t){ok(!$.blueimp.fileupload.prototype.options.send.call(this,e,t));return!1}}).fileupload("send",{files:[{name:"test",size:999}]})});test("acceptFileTypes",function(){expect(3);var e=0,t=0;$("#fileupload").fileupload({autoUpload:!0,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,previewFileTypes:/none/,send:function(n,r){strictEqual(t+=1,e);return!1}}).fileupload("add",{files:[{name:(e+=1)+".jpg"}]}).fileupload("add",{files:[{name:e+=1,type:"image/jpeg"}]}).fileupload("add",{files:[{name:"test.txt",type:"text/plain"}]}).fileupload({send:function(e,t){ok(!$.blueimp.fileupload.prototype.options.send.call(this,e,t));return!1}}).fileupload("send",{files:[{name:"test.txt",type:"text/plain"}]})});test("acceptFileTypes as HTML5 data attribute",function(){expect(2);var e=/(\.|\/)(gif|jpe?g|png)$/i;$("#fileupload").attr("data-accept-file-types",e.toString()).fileupload();strictEqual($.type($("#fileupload").fileupload("option","acceptFileTypes")),$.type(e));strictEqual($("#fileupload").fileupload("option","acceptFileTypes").toString(),e.toString())})});