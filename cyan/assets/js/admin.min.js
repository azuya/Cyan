/*
@codekit-append "bootstrap-colorpicker.js", "bootstrap-datepicker.js", "bootstrap-timepicker.js";
@codekit-append "holder.js", "jquery.nestable.js";

@codekit-append "../../vendor/fileupload/js/vendor/jquery.ui.widget.js";
@codekit-append "../../vendor/fileupload/js/iframe-transport.js";
@codekit-append "../../vendor/fileupload/js/jquery.fileupload.js";
*/function go_to_page(e){console.log("go_to_page("+e+")");if($("#top").length==0){window.location=e;return}if(e.indexOf("#")==0){console.log("Starts with hash (#)...");return!1}var t=e;t=t.replace(/\/cyan\//g,"");t=t.replace(/\/admin\//g,"admin/");t=t.replace(/\//g,"-").toLowerCase();console.log(t);var n=t.replace(/\//g,"-").toLowerCase(),n=n.replace(/\?/g,"-"),n=n.replace(/&/g,"-"),n=n.replace(/=/g,"-"),n=n.replace(/--/g,"-");console.log("PageID: "+n);if($("#"+n).length==0){start_progress();console.log("#"+n+" doesn't exist -> load");$.ajax({type:"GET",url:e,data:"",success:function(t){$("#content .screen").removeClass("active");$("#content").append(t);end_progress();window.history.pushState(null,"",e)},error:function(){end_progress();modal("Ooops!","Something went wrong, it looks as if the page couldn't be loaded. Check the link and try again?")}})}else{console.log("Exists: #"+n);$(".screen").removeClass("active");$("#"+n).addClass("active");end_progress()}var r=$(".submenu");r.removeClass("active");$(this).find("li.active").removeClass("active")}function start_progress(){var e='<div id="system-progress"><i class="progress-icon rotate-infinite"></i><br></div>';$("body").append(e).fadeIn()}function end_progress(){$("#system-progress").fadeOut(400,function(){$(this).remove()})}function browse_away_confirmation(){console.log("browse_away_confirmation()");end_progress()}function modal(e,t,n,r){r==undefined&&(r='<a href="#" class="btn btn-primary" data-dismiss="modal">Close</a>');n='<div class="icon"><i class="icon60-blue-exclamation"></i></div>';var i='<div id="modal-box" class="modal hide fade"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>'+e+"</h3>"+"</div>"+'<div class="modal-body">'+n+"<p>"+t+"</p>"+"</div>"+'<div class="modal-footer">'+r+"</div>"+"</div>";$("body").append(i);$("#modal-box").modal({})}$(document).ready(function(){$(window).scroll(function(e){var t=$(this).scrollTop();t>=40?$("#scroll-to-top").removeClass("offscreen"):$("#scroll-to-top").addClass("offscreen")});$(document).on("click","a",function(e){var t=$(this).attr("href");go_to_page(t);return!1});setTimeout(function(){$(window).bind("popstate",function(e){console.log("POP to: "+location.href);go_to_page(location.href)})},500);$("header.admin ul.nav > li > a:not(.no-dropdown)").click(function(){$("header.admin ul.nav").find("li.active").removeClass("active");$(this).parent().addClass("active");$("header.admin ul.nav").find(".submenu").removeClass("active");$(this).next().addClass("active");return!1});$(document).mouseup(function(e){var t=$(".submenu");if(t.has(e.target).length===0){t.removeClass("active");$(this).find("li.active").removeClass("active")}});$("div.photo").hover(function(){$(this).find("a.change-photo").show()},function(){$(this).find("a.change-photo").hide()});$("#search-trigger").click(function(){$("#q").focus()});$(document).click(function(){$("html, body").animate({scrollTop:0},"fast")});$(document).on("hover","table.table tr",function(){$(this).find(".row-show-on-hover").show()},function(){$(this).find(".row-show-on-hover").hide()});$("body").css("padding-top","44px");var e='<div id="system-alert" class="alert alert-block fade in"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Warning!</strong> Someone else is editing this content. It\'s advised that you don\'t edit it at the same time.</div>';$("body").append(e);$("*[rel=tooltip]").tooltip({animation:!0,delay:{show:1e3,hide:100},placement:"top"});$("*[rel=tooltip]").on("click",function(){$(this).tooltip("hide")});$("a[rel=popover]").popover({animation:!0,delay:{show:500,hide:100},placement:"right",html:!0}).click(function(e){e.preventDefault()});$(document).on("click","label",function(){$(this).parent().find('*[name="'+$(this).attr("for")+'"]').focus()})});!function(e){var t=function(e){this.value={h:1,s:1,b:1,a:1};this.setColor(e)};t.prototype={constructor:t,setColor:function(t){t=t.toLowerCase();var n=this;e.each(r.stringParsers,function(e,i){var s=i.re.exec(t),o=s&&i.parse(s),u=i.space||"rgba";if(o){u==="hsla"?n.value=r.RGBtoHSB.apply(null,r.HSLtoRGB.apply(null,o)):n.value=r.RGBtoHSB.apply(null,o);return!1}})},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt((1-e)*100,10)/100},toRGB:function(e,t,n,r){if(!e){e=this.value.h;t=this.value.s;n=this.value.b}e*=360;var i,s,o,u,a;e=e%360/60;a=n*t;u=a*(1-Math.abs(e%2-1));i=s=o=n-a;e=~~e;i+=[a,u,0,0,u,a][e];s+=[u,a,a,u,0,0][e];o+=[0,0,u,a,a,u][e];return{r:Math.round(i*255),g:Math.round(s*255),b:Math.round(o*255),a:r||this.value.a}},toHex:function(e,t,n,r){var i=this.toRGB(e,t,n,r);return"#"+(1<<24|parseInt(i.r)<<16|parseInt(i.g)<<8|parseInt(i.b)).toString(16).substr(1)},toHSL:function(e,t,n,r){if(!e){e=this.value.h;t=this.value.s;n=this.value.b}var i=e,s=(2-t)*n,o=t*n;s>0&&s<=1?o/=s:o/=2-s;s/=2;o>1&&(o=1);return{h:i,s:o,l:s,a:r||this.value.a}}};var n=function(t,n){this.element=e(t);var i=n.format||this.element.data("color-format")||"hex";this.format=r.translateFormats[i];this.isInput=this.element.is("input");this.component=this.element.is(".color")?this.element.find(".add-on"):!1;this.picker=e(r.template).appendTo("body").on("mousedown",e.proxy(this.mousedown,this));this.isInput?this.element.on({focus:e.proxy(this.show,this),keyup:e.proxy(this.update,this)}):this.component?this.component.on({click:e.proxy(this.show,this)}):this.element.on({click:e.proxy(this.show,this)});if(i==="rgba"||i==="hsla"){this.picker.addClass("alpha");this.alpha=this.picker.find(".colorpicker-alpha")[0].style}if(this.component){this.picker.find(".colorpicker-color").hide();this.preview=this.element.find("i")[0].style}else this.preview=this.picker.find("div:last")[0].style;this.base=this.picker.find("div:first")[0].style;this.update()};n.prototype={constructor:n,show:function(t){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();e(window).on("resize",e.proxy(this.place,this));if(!this.isInput&&t){t.stopPropagation();t.preventDefault()}e(document).on({mousedown:e.proxy(this.hide,this)});this.element.trigger({type:"show",color:this.color})},update:function(){this.color=new t(this.isInput?this.element.prop("value"):this.element.data("color"));this.picker.find("i").eq(0).css({left:this.color.value.s*100,top:100-this.color.value.b*100}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a));this.previewColor()},setValue:function(e){this.color=new t(e);this.picker.find("i").eq(0).css({left:this.color.value.s*100,top:100-this.color.value.b*100}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a));this.previewColor();this.element.trigger({type:"changeColor",color:this.color})},hide:function(){this.picker.hide();e(window).off("resize",this.place);if(!this.isInput){e(document).off({mousedown:this.hide});this.component&&this.element.find("input").prop("value",this.format.call(this));this.element.data("color",this.format.call(this))}else this.element.prop("value",this.format.call(this));this.element.trigger({type:"hide",color:this.color})},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1);this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation();t.preventDefault();var n=e(t.target),i=n.closest("div");if(!i.is(".colorpicker")){if(i.is(".colorpicker-saturation"))this.slider=e.extend({},r.sliders.saturation);else if(i.is(".colorpicker-hue"))this.slider=e.extend({},r.sliders.hue);else{if(!i.is(".colorpicker-alpha"))return!1;this.slider=e.extend({},r.sliders.alpha)}var s=i.offset();this.slider.knob=i.find("i")[0].style;this.slider.left=t.pageX-s.left;this.slider.top=t.pageY-s.top;this.pointer={left:t.pageX,top:t.pageY};e(document).on({mousemove:e.proxy(this.mousemove,this),mouseup:e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){e.stopPropagation();e.preventDefault();var t=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((e.pageX||this.pointer.left)-this.pointer.left))),n=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((e.pageY||this.pointer.top)-this.pointer.top)));this.slider.knob.left=t+"px";this.slider.knob.top=n+"px";this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,t/100);this.slider.callTop&&this.color[this.slider.callTop].call(this.color,n/100);this.previewColor();this.element.trigger({type:"changeColor",color:this.color});return!1},mouseup:function(t){t.stopPropagation();t.preventDefault();e(document).off({mousemove:this.mousemove,mouseup:this.mouseup});return!1}};e.fn.colorpicker=function(t){return this.each(function(){var r=e(this),i=r.data("colorpicker"),s=typeof t=="object"&&t;i||r.data("colorpicker",i=new n(this,e.extend({},e.fn.colorpicker.defaults,s)));typeof t=="string"&&i[t]()})};e.fn.colorpicker.defaults={};e.fn.colorpicker.Constructor=n;var r={translateFormats:{rgb:function(){var e=this.color.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.color.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hsl:function(){var e=this.color.toHSL();return"hsl("+Math.round(e.h*360)+","+Math.round(e.s*100)+"%,"+Math.round(e.l*100)+"%)"},hsla:function(){var e=this.color.toHSL();return"hsla("+Math.round(e.h*360)+","+Math.round(e.s*100)+"%,"+Math.round(e.l*100)+"%,"+e.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(e,t,n,r){e/=255;t/=255;n/=255;var i,s,o,u;o=Math.max(e,t,n);u=o-Math.min(e,t,n);i=u===0?null:o==e?(t-n)/u:o==t?(n-e)/u+2:(e-t)/u+4;i=(i+360)%6*60/360;s=u===0?0:u/o;return{h:i||1,s:s,b:o,a:r||1}},HueToRGB:function(e,t,n){n<0?n+=1:n>1&&(n-=1);return n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e},HSLtoRGB:function(e,t,n,i){t<0&&(t=0);var s;n<=.5?s=n*(1+t):s=n+t-n*t;var o=2*n-s,u=e+1/3,a=e,f=e-1/3,l=Math.round(r.HueToRGB(o,s,u)*255),c=Math.round(r.HueToRGB(o,s,a)*255),h=Math.round(r.HueToRGB(o,s,f)*255);return[l,c,h,i||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery);!function(e){var t=function(t,r){this.element=e(t);this.format=n.parseFormat(r.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=e(n.template).appendTo("body").on({click:e.proxy(this.click,this),mousedown:e.proxy(this.mousedown,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;this.isInput?this.element.on({focus:e.proxy(this.show,this),blur:e.proxy(this.hide,this),keyup:e.proxy(this.update,this)}):this.component?this.component.on("click",e.proxy(this.show,this)):this.element.on("click",e.proxy(this.show,this));this.minViewMode=r.minViewMode||this.element.data("date-minviewmode")||0;if(typeof this.minViewMode=="string")switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=r.viewMode||this.element.data("date-viewmode")||0;if(typeof this.viewMode=="string")switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;this.weekStart=r.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.fillDow();this.fillMonths();this.update();this.showMode()};t.prototype={constructor:t,show:function(t){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();e(window).on("resize",e.proxy(this.place,this));if(t){t.stopPropagation();t.preventDefault()}this.isInput||e(document).on("mousedown",e.proxy(this.hide,this));this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();e(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||e(document).off("mousedown",this.hide);this.set();this.element.trigger({type:"hide",date:this.date})},set:function(){var e=n.formatDate(this.date,this.format);if(!this.isInput){this.component&&this.element.find("input").prop("value",e);this.element.data("date",e)}else this.element.prop("value",e)},setValue:function(e){typeof e=="string"?this.date=n.parseDate(e,this.format):this.date=new Date(e);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},update:function(e){this.date=n.parseDate(typeof e=="string"?e:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){var e=this.weekStart,t="<tr>";while(e<this.weekStart+7)t+='<th class="dow">'+n.dates.daysMin[e++%7]+"</th>";t+="</tr>";this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){var e="",t=0;while(t<12)e+='<span class="month">'+n.dates.monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").append(e)},fill:function(){var e=new Date(this.viewDate),t=e.getFullYear(),r=e.getMonth(),i=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(n.dates.months[r]+" "+t);var s=new Date(t,r-1,28,0,0,0,0),o=n.getDaysInMonth(s.getFullYear(),s.getMonth());s.setDate(o);s.setDate(o-(s.getDay()-this.weekStart+7)%7);var u=new Date(s);u.setDate(u.getDate()+42);u=u.valueOf();html=[];var a;while(s.valueOf()<u){s.getDay()===this.weekStart&&html.push("<tr>");a="";s.getMonth()<r?a+=" old":s.getMonth()>r&&(a+=" new");s.valueOf()===i&&(a+=" active");html.push('<td class="day'+a+'">'+s.getDate()+"</td>");s.getDay()===this.weekEnd&&html.push("</tr>");s.setDate(s.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var f=this.date.getFullYear(),l=this.picker.find(".datepicker-months").find("th:eq(1)").text(t).end().find("span").removeClass("active");f===t&&l.eq(this.date.getMonth()).addClass("active");html="";t=parseInt(t/10,10)*10;var c=this.picker.find(".datepicker-years").find("th:eq(1)").text(t+"-"+(t+9)).end().find("td");t-=1;for(var h=-1;h<11;h++){html+='<span class="year'+(h===-1||h===10?" old":"")+(f===t?" active":"")+'">'+t+"</span>";t+=1}c.html(html)},click:function(t){t.stopPropagation();t.preventDefault();var r=e(t.target).closest("span, td, th");if(r.length===1)switch(r[0].nodeName.toLowerCase()){case"th":switch(r[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+n.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+n.modes[this.viewMode].navFnc].call(this.viewDate)+n.modes[this.viewMode].navStep*(r[0].className==="prev"?-1:1));this.fill();this.set()}break;case"span":if(r.is(".month")){var i=r.parent().find("span").index(r);this.viewDate.setMonth(i)}else{var s=parseInt(r.text(),10)||0;this.viewDate.setFullYear(s)}if(this.viewMode!==0){this.date=new Date(this.viewDate);this.element.trigger({type:"changeDate",date:this.date,viewMode:n.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set();break;case"td":if(r.is(".day")){var o=parseInt(r.text(),10)||1,i=this.viewDate.getMonth();r.is(".old")?i-=1:r.is(".new")&&(i+=1);var s=this.viewDate.getFullYear();this.date=new Date(s,i,o,0,0,0,0);this.viewDate=new Date(s,i,Math.min(28,o),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:n.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(e){e&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+e)));this.picker.find(">div").hide().filter(".datepicker-"+n.modes[this.viewMode].clsName).show()}};e.fn.datepicker=function(n,r){return this.each(function(){var i=e(this),s=i.data("datepicker"),o=typeof n=="object"&&n;s||i.data("datepicker",s=new t(this,e.extend({},e.fn.datepicker.defaults,o)));typeof n=="string"&&s[n](r)})};e.fn.datepicker.defaults={};e.fn.datepicker.Constructor=t;var n={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,n.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),n=e.split(/\W+/);if(!t||!n||n.length===0)throw new Error("Invalid date format.");return{separator:t,parts:n}},parseDate:function(e,t){var n=e.split(t.separator),e=new Date,r;e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);if(n.length===t.parts.length)for(var i=0,s=t.parts.length;i<s;i++){r=parseInt(n[i],10)||1;switch(t.parts[i]){case"dd":case"d":e.setDate(r);break;case"mm":case"m":e.setMonth(r-1);break;case"yy":e.setFullYear(2e3+r);break;case"yyyy":e.setFullYear(r)}}return e},formatDate:function(e,t){var n={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()};n.dd=(n.d<10?"0":"")+n.d;n.mm=(n.m<10?"0":"")+n.m;var e=[];for(var r=0,i=t.parts.length;r<i;r++)e.push(n[t.parts[r]]);return e.join(t.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};n.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+n.headTemplate+"<tbody></tbody>"+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+n.headTemplate+n.contTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+n.headTemplate+n.contTemplate+"</table>"+"</div>"+"</div>"}(window.jQuery);!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.timepicker.defaults,n,this.$element.data());this.minuteStep=this.options.minuteStep||this.minuteStep;this.secondStep=this.options.secondStep||this.secondStep;this.showMeridian=this.options.showMeridian||this.showMeridian;this.showSeconds=this.options.showSeconds||this.showSeconds;this.showInputs=this.options.showInputs||this.showInputs;this.disableFocus=this.options.disableFocus||this.disableFocus;this.template=this.options.template||this.template;this.modalBackdrop=this.options.modalBackdrop||this.modalBackdrop;this.defaultTime=this.options.defaultTime||this.defaultTime;this.open=!1;this.init()};t.prototype={constructor:t,init:function(){if(this.$element.parent().hasClass("input-append")){this.$element.parent(".input-append").find(".add-on").on("click",e.proxy(this.showWidget,this));this.$element.on({focus:e.proxy(this.highlightUnit,this),click:e.proxy(this.highlightUnit,this),keypress:e.proxy(this.elementKeypress,this),blur:e.proxy(this.blurElement,this)})}else this.template?this.$element.on({focus:e.proxy(this.showWidget,this),click:e.proxy(this.showWidget,this),blur:e.proxy(this.blurElement,this)}):this.$element.on({focus:e.proxy(this.highlightUnit,this),click:e.proxy(this.highlightUnit,this),keypress:e.proxy(this.elementKeypress,this),blur:e.proxy(this.blurElement,this)});this.$widget=e(this.getTemplate()).appendTo("body");this.$widget.on("click",e.proxy(this.widgetClick,this));this.showInputs&&this.$widget.find("input").on({click:function(){this.select()},keypress:e.proxy(this.widgetKeypress,this),change:e.proxy(this.updateFromWidgetInputs,this)});this.setDefaultTime(this.defaultTime)},showWidget:function(t){t.stopPropagation();t.preventDefault();if(this.open)return;this.$element.trigger("show");this.disableFocus&&this.$element.blur();var n=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.updateFromElementVal();e("html").trigger("click.timepicker.data-api").one("click.timepicker.data-api",e.proxy(this.hideWidget,this));if(this.template==="modal")this.$widget.modal("show").on("hidden",e.proxy(this.hideWidget,this));else{this.$widget.css({top:n.top+n.height,left:n.left});this.open||this.$widget.addClass("open")}this.open=!0;this.$element.trigger("shown")},hideWidget:function(){this.$element.trigger("hide");this.template==="modal"?this.$widget.modal("hide"):this.$widget.removeClass("open");this.open=!1;this.$element.trigger("hidden")},widgetClick:function(t){t.stopPropagation();t.preventDefault();var n=e(t.target).closest("a").data("action");if(n){this[n]();this.update()}},widgetKeypress:function(t){var n=e(t.target).closest("input").attr("name");switch(t.keyCode){case 9:this.showMeridian?n=="meridian"&&this.hideWidget():this.showSeconds?n=="second"&&this.hideWidget():n=="minute"&&this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(n){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.update();break;case 40:switch(n){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.update()}},elementKeypress:function(e){var t=this.$element.get(0);switch(e.keyCode){case 0:break;case 9:this.updateFromElementVal();if(this.showMeridian){if(this.highlightedUnit!="meridian"){e.preventDefault();this.highlightNextUnit()}}else if(this.showSeconds){if(this.highlightedUnit!="second"){e.preventDefault();this.highlightNextUnit()}}else if(this.highlightedUnit!="minute"){e.preventDefault();this.highlightNextUnit()}break;case 27:this.updateFromElementVal();break;case 37:this.updateFromElementVal();this.highlightPrevUnit();break;case 38:switch(this.highlightedUnit){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.updateElement();break;case 39:this.updateFromElementVal();this.highlightNextUnit();break;case 40:switch(this.highlightedUnit){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.updateElement()}e.keyCode!==0&&e.keyCode!==8&&e.keyCode!==9&&e.keyCode!==46&&e.preventDefault()},setValues:function(e){if(this.showMeridian){var t=e.split(" "),n=t[0].split(":");this.meridian=t[1]}else var n=e.split(":");this.hour=parseInt(n[0],10);this.minute=parseInt(n[1],10);this.second=parseInt(n[2],10);isNaN(this.hour)&&(this.hour=0);isNaN(this.minute)&&(this.minute=0);if(this.showMeridian){this.hour>12?this.hour=12:this.hour<1&&(this.hour=1);if(this.meridian=="am"||this.meridian=="a")this.meridian="AM";else if(this.meridian=="pm"||this.meridian=="p")this.meridian="PM";this.meridian!="AM"&&this.meridian!="PM"&&(this.meridian="AM")}else this.hour>=24?this.hour=23:this.hour<0&&(this.hour=0);this.minute<0?this.minute=0:this.minute>=60&&(this.minute=59);this.showSeconds&&(isNaN(this.second)?this.second=0:this.second<0?this.second=0:this.second>=60&&(this.second=59));this.$element.val()!=""&&this.updateElement();this.updateWidget()},setMeridian:function(e){e=="a"||e=="am"||e=="AM"?this.meridian="AM":e=="p"||e=="pm"||e=="PM"?this.meridian="PM":this.updateWidget();this.updateElement()},setDefaultTime:function(e){if(e){if(e==="current"){var t=new Date,n=t.getHours(),r=Math.floor(t.getMinutes()/this.minuteStep)*this.minuteStep,i=Math.floor(t.getSeconds()/this.secondStep)*this.secondStep,s="AM";if(this.showMeridian)if(n===0)n=12;else if(n>=12){n>12&&(n-=12);s="PM"}else s="AM";this.hour=n;this.minute=r;this.second=i;this.meridian=s}else e==="value"?this.setValues(this.$element.val()):this.setValues(e);this.$element.val()!=""&&this.updateElement();this.updateWidget()}else{this.hour=0;this.minute=0;this.second=0}},formatTime:function(e,t,n,r){e=e<10?"0"+e:e;t=t<10?"0"+t:t;n=n<10?"0"+n:n;return e+":"+t+(this.showSeconds?":"+n:"")+(this.showMeridian?" "+r:"")},getTime:function(){return this.formatTime(this.hour,this.minute,this.second,this.meridian)},setTime:function(e){this.setValues(e);this.update()},update:function(){this.updateElement();this.updateWidget()},blurElement:function(){this.highlightedUnit=undefined;this.updateFromElementVal()},updateElement:function(){var e=this.getTime();this.$element.val(e).change();switch(this.highlightedUnit){case"hour":this.highlightHour();break;case"minute":this.highlightMinute();break;case"second":this.highlightSecond();break;case"meridian":this.highlightMeridian()}},updateWidget:function(){if(this.showInputs){this.$widget.find("input.bootstrap-timepicker-hour").val(this.hour<10?"0"+this.hour:this.hour);this.$widget.find("input.bootstrap-timepicker-minute").val(this.minute<10?"0"+this.minute:this.minute);this.showSeconds&&this.$widget.find("input.bootstrap-timepicker-second").val(this.second<10?"0"+this.second:this.second);this.showMeridian&&this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)}else{this.$widget.find("span.bootstrap-timepicker-hour").text(this.hour);this.$widget.find("span.bootstrap-timepicker-minute").text(this.minute<10?"0"+this.minute:this.minute);this.showSeconds&&this.$widget.find("span.bootstrap-timepicker-second").text(this.second<10?"0"+this.second:this.second);this.showMeridian&&this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian)}},updateFromElementVal:function(e){var t=this.$element.val();if(t){this.setValues(t);this.updateWidget()}},updateFromWidgetInputs:function(){var t=e("input.bootstrap-timepicker-hour",this.$widget).val()+":"+e("input.bootstrap-timepicker-minute",this.$widget).val()+(this.showSeconds?":"+e("input.bootstrap-timepicker-second",this.$widget).val():"")+(this.showMeridian?" "+e("input.bootstrap-timepicker-meridian",this.$widget).val():"");this.setValues(t)},getCursorPosition:function(){var e=this.$element.get(0);if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;t.moveStart("character",-e.value.length);return t.text.length-n}},highlightUnit:function(){var e=this.$element.get(0);this.position=this.getCursorPosition();this.position>=0&&this.position<=2?this.highlightHour():this.position>=3&&this.position<=5?this.highlightMinute():this.position>=6&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():this.position>=9&&this.position<=11&&this.highlightMeridian()},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.highlightMeridian();break;case"second":this.highlightMeridian();break;case"meridian":this.highlightHour()}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMeridian();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour:function(){this.highlightedUnit="hour";this.$element.get(0).setSelectionRange(0,2)},highlightMinute:function(){this.highlightedUnit="minute";this.$element.get(0).setSelectionRange(3,5)},highlightSecond:function(){this.highlightedUnit="second";this.$element.get(0).setSelectionRange(6,8)},highlightMeridian:function(){this.highlightedUnit="meridian";this.showSeconds?this.$element.get(0).setSelectionRange(9,11):this.$element.get(0).setSelectionRange(6,8)},incrementHour:function(){if(this.showMeridian)if(this.hour===11)this.toggleMeridian();else if(this.hour===12)return this.hour=1;if(this.hour===23)return this.hour=0;this.hour=this.hour+1},decrementHour:function(){if(this.showMeridian){if(this.hour===1)return this.hour=12;this.hour===12&&this.toggleMeridian()}if(this.hour===0)return this.hour=23;this.hour=this.hour-1},incrementMinute:function(){var e=this.minute+this.minuteStep-this.minute%this.minuteStep;if(e>59){this.incrementHour();this.minute=e-60}else this.minute=e},decrementMinute:function(){var e=this.minute-this.minuteStep;if(e<0){this.decrementHour();this.minute=e+60}else this.minute=e},incrementSecond:function(){var e=this.second+this.secondStep-this.second%this.secondStep;if(e>59){this.incrementMinute();this.second=e-60}else this.second=e},decrementSecond:function(){var e=this.second-this.secondStep;if(e<0){this.decrementMinute();this.second=e+60}else this.second=e},toggleMeridian:function(){this.meridian=this.meridian==="AM"?"PM":"AM";this.update()},getTemplate:function(){if(this.options.templates[this.options.template])return this.options.templates[this.options.template];if(this.showInputs)var e='<input type="text" name="hour" class="bootstrap-timepicker-hour" maxlength="2"/>',t='<input type="text" name="minute" class="bootstrap-timepicker-minute" maxlength="2"/>',n='<input type="text" name="second" class="bootstrap-timepicker-second" maxlength="2"/>',r='<input type="text" name="meridian" class="bootstrap-timepicker-meridian" maxlength="2"/>';else var e='<span class="bootstrap-timepicker-hour"></span>',t='<span class="bootstrap-timepicker-minute"></span>',n='<span class="bootstrap-timepicker-second"></span>',r='<span class="bootstrap-timepicker-meridian"></span>';var i='<table class="'+(this.showSeconds?"show-seconds":"")+" "+(this.showMeridian?"show-meridian":"")+'">'+"<tr>"+'<td><a href="#" data-action="incrementHour"><i class="icon-chevron-up"></i></a></td>'+'<td class="separator">&nbsp;</td>'+'<td><a href="#" data-action="incrementMinute"><i class="icon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="icon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="icon-chevron-up"></i></a></td>':"")+"</tr>"+"<tr>"+"<td>"+e+"</td> "+'<td class="separator">:</td>'+"<td>"+t+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+n+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+r+"</td>":"")+"</tr>"+"<tr>"+'<td><a href="#" data-action="decrementHour"><i class="icon-chevron-down"></i></a></td>'+'<td class="separator"></td>'+'<td><a href="#" data-action="decrementMinute"><i class="icon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="icon-chevron-down"></i></a></td>':"")+(this
.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="icon-chevron-down"></i></a></td>':"")+"</tr>"+"</table>",s;switch(this.options.template){case"modal":s='<div class="bootstrap-timepicker modal hide fade in" style="top: 30%; margin-top: 0; width: 200px; margin-left: -100px;" data-backdrop="'+(this.modalBackdrop?"true":"false")+'">'+'<div class="modal-header">'+'<a href="#" class="close" data-dismiss="modal">Ã—</a>'+"<h3>Pick a Time</h3>"+"</div>"+'<div class="modal-content">'+i+"</div>"+'<div class="modal-footer">'+'<a href="#" class="btn btn-primary" data-dismiss="modal">Ok</a>'+"</div>"+"</div>";break;case"dropdown":s='<div class="bootstrap-timepicker dropdown-menu">'+i+"</div>"}return s}};e.fn.timepicker=function(n){return this.each(function(){var r=e(this),i=r.data("timepicker"),s=typeof n=="object"&&n;i||r.data("timepicker",i=new t(this,s));typeof n=="string"&&i[n]()})};e.fn.timepicker.defaults={minuteStep:15,secondStep:15,disableFocus:!1,defaultTime:"current",showSeconds:!1,showInputs:!0,showMeridian:!0,template:"dropdown",modalBackdrop:!1,templates:{}};e.fn.timepicker.Constructor=t}(window.jQuery);var Holder=Holder||{};(function(e,t){function o(e,t){var n="complete",r="readystatechange",i=!1,s=i,o=!0,u=e.document,a=u.documentElement,f=u.addEventListener?"addEventListener":"attachEvent",l=u.addEventListener?"removeEventListener":"detachEvent",c=u.addEventListener?"":"on",h=function(o){(o.type!=r||u.readyState==n)&&((o.type=="load"?e:u)[l](c+o.type,h,i),!s&&(s=!0)&&t.call(e,null))},p=function(){try{a.doScroll("left")}catch(e){setTimeout(p,50);return}h("poll")};if(u.readyState==n)t.call(e,"lazy");else{if(u.createEventObject&&a.doScroll){try{o=!e.frameElement}catch(d){}o&&p()}u[f](c+"DOMContentLoaded",h,i),u[f](c+r,h,i),e[f](c+"load",h,i)}}function u(e){e=e.match(/^(\W)?(.*)/);var t=document["getElement"+(e[1]?e[1]=="#"?"ById":"sByClassName":"sByTagName")](e[2]),n=[];t!=null&&(t.length?n=t:t.length==0?n=t:n=[t]);return n}function a(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n}function f(e,t,n){var r=[t,e].sort(),i=Math.round(r[1]/16),s=Math.round(r[0]/16),o=Math.max(n.size,i);return{height:o}}function l(e,t,n,r){var i=f(t.width,t.height,n),o=i.height,u=t.width*r,a=t.height*r,l=n.font?n.font:"sans-serif";s.width=u;s.height=a;e.textAlign="center";e.textBaseline="middle";e.fillStyle=n.background;e.fillRect(0,0,u,a);e.fillStyle=n.foreground;e.font="bold "+o+"px "+l;var c=n.text?n.text:t.width+"x"+t.height;e.measureText(c).width/u>1&&(o=n.size/(e.measureText(c).width/u));e.font="bold "+o*r+"px "+l;e.fillText(c,u/2,a/2,u);return s.toDataURL("image/png")}function c(e,t,n,i){var s=n.dimensions,o=n.theme,u=n.text?decodeURIComponent(n.text):n.text,f=s.width+"x"+s.height;o=u?a(o,{text:u}):o;o=n.font?a(o,{font:n.font}):o;var c=1;window.devicePixelRatio&&window.devicePixelRatio>1&&(c=window.devicePixelRatio);if(e=="image"){t.setAttribute("data-src",i);t.setAttribute("alt",u?u:o.text?o.text+" ["+f+"]":f);if(r||!n.auto){t.style.width=s.width+"px";t.style.height=s.height+"px"}r?t.style.backgroundColor=o.background:t.setAttribute("src",l(v,s,o,c))}else if(!r){t.style.backgroundImage="url("+l(v,s,o,c)+")";t.style.backgroundSize=s.width+"px "+s.height+"px"}}function h(e,t,n){var r=t.dimensions,i=t.theme,s=t.text,o=r.width+"x"+r.height;i=s?a(i,{text:s}):i;var u=document.createElement("div");u.style.backgroundColor=i.background;u.style.color=i.foreground;u.className=e.className+" holderjs-fluid";u.style.width=t.dimensions.width+(t.dimensions.width.indexOf("%")>0?"":"px");u.style.height=t.dimensions.height+(t.dimensions.height.indexOf("%")>0?"":"px");u.id=e.id;e.style.width=0;e.style.height=0;if(i.text)u.appendChild(document.createTextNode(i.text));else{u.appendChild(document.createTextNode(o));m.push(u);setTimeout(p,0)}e.parentNode.insertBefore(u,e.nextSibling);window.jQuery&&jQuery(function(t){t(e).on("load",function(){e.style.width=u.style.width;e.style.height=u.style.height;t(e).show();t(u).remove()})})}function p(){for(i in m){if(!m.hasOwnProperty(i))continue;var e=m[i],t=e.firstChild;e.style.lineHeight=e.offsetHeight+"px";t.data=e.offsetWidth+"x"+e.offsetHeight}}function d(t,n){var r={theme:g.themes.gray},i=!1;for(sl=t.length,j=0;j<sl;j++){var s=t[j];if(e.flags.dimensions.match(s)){i=!0;r.dimensions=e.flags.dimensions.output(s)}else if(e.flags.fluid.match(s)){i=!0;r.dimensions=e.flags.fluid.output(s);r.fluid=!0}else e.flags.colors.match(s)?r.theme=e.flags.colors.output(s):n.themes[s]?r.theme=n.themes[s]:e.flags.text.match(s)?r.text=e.flags.text.output(s):e.flags.font.match(s)?r.font=e.flags.font.output(s):e.flags.auto.match(s)&&(r.auto=!0)}return i?r:!1}var n=!1,r=!1,s=document.createElement("canvas");document.getElementsByClassName||(document.getElementsByClassName=function(e){var t=document,n,r,i,s=[];if(t.querySelectorAll)return t.querySelectorAll("."+e);if(t.evaluate){r=".//*[contains(concat(' ', @class, ' '), ' "+e+" ')]",n=t.evaluate(r,t,null,0,null);while(i=n.iterateNext())s.push(i)}else{n=t.getElementsByTagName("*"),r=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0;i<n.length;i++)r.test(n[i].className)&&s.push(n[i])}return s});window.getComputedStyle||(window.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t=="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this});Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e){var t=this.__proto__||this.constructor.prototype;return e in this&&(!(e in t)||t[e]!==this[e])});if(!s.getContext)r=!0;else if(s.toDataURL("image/png").indexOf("data:image/png")<0)r=!0;else var v=s.getContext("2d");var m=[],g={domain:"holder.js",images:"img",bgnodes:".holderjs",themes:{gray:{background:"#eee",foreground:"#aaa",size:12},social:{background:"#3a5a97",foreground:"#fff",size:12},industrial:{background:"#434A52",foreground:"#C2F200",size:12}},stylesheet:".holderjs-fluid {font-size:16px;font-weight:bold;text-align:center;font-family:sans-serif;margin:0}"};e.flags={dimensions:{regex:/^(\d+)x(\d+)$/,output:function(e){var t=this.regex.exec(e);return{width:+t[1],height:+t[2]}}},fluid:{regex:/^([0-9%]+)x([0-9%]+)$/,output:function(e){var t=this.regex.exec(e);return{width:t[1],height:t[2]}}},colors:{regex:/#([0-9a-f]{3,})\:#([0-9a-f]{3,})/i,output:function(e){var t=this.regex.exec(e);return{size:g.themes.gray.size,foreground:"#"+t[2],background:"#"+t[1]}}},text:{regex:/text\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},font:{regex:/font\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},auto:{regex:/^auto$/}};for(var y in e.flags){if(!e.flags.hasOwnProperty(y))continue;e.flags[y].match=function(e){return e.match(this.regex)}}e.add_theme=function(t,n){t!=null&&n!=null&&(g.themes[t]=n);return e};e.add_image=function(t,n){var r=u(n);if(r.length)for(var i=0,s=r.length;i<s;i++){var o=document.createElement("img");o.setAttribute("data-src",t);r[i].appendChild(o)}return e};e.run=function(t){var r=a(g,t),i=[];r.images instanceof window.NodeList?imageNodes=r.images:r.images instanceof window.Node?imageNodes=[r.images]:imageNodes=u(r.images);r.elements instanceof window.NodeList?bgnodes=r.bgnodes:r.bgnodes instanceof window.Node?bgnodes=[r.bgnodes]:bgnodes=u(r.bgnodes);n=!0;for(l=0,f=imageNodes.length;l<f;l++)i.push(imageNodes[l]);var s=document.getElementById("holderjs-style");if(!s){s=document.createElement("style");s.setAttribute("id","holderjs-style");s.type="text/css";document.getElementsByTagName("head")[0].appendChild(s)}s.styleSheet?s.styleSheet+=r.stylesheet:s.textContent+=r.stylesheet;var o=new RegExp(r.domain+'/(.*?)"?\\)');for(var f=bgnodes.length,l=0;l<f;l++){var p=window.getComputedStyle(bgnodes[l],null).getPropertyValue("background-image"),v=p.match(o);if(v){var m=d(v[1].split("/"),r);m&&c("background",bgnodes[l],m,p)}}for(var f=i.length,l=0;l<f;l++){var p=i[l].getAttribute("src")||i[l].getAttribute("data-src");if(p!=null&&p.indexOf(r.domain)>=0){var m=d(p.substr(p.lastIndexOf(r.domain)+r.domain.length+1).split("/"),r);m&&(m.fluid?h(i[l],m,p):c("image",i[l],m,p))}}return e};o(t,function(){if(window.addEventListener){window.addEventListener("resize",p,!1);window.addEventListener("orientationchange",p,!1)}else window.attachEvent("onresize",p);n||e.run()});typeof define=="function"&&define.amd&&define("Holder",[],function(){return e})})(Holder,window);(function(e,t,n,r){function l(n,r){this.w=e(t);this.el=e(n);this.options=e.extend({},f,r);this.init()}var i="ontouchstart"in t,s=function(){var e=n.createElement("div"),r=n.documentElement;if("pointerEvents"in e.style){e.style.pointerEvents="auto";e.style.pointerEvents="x";r.appendChild(e);var i=t.getComputedStyle&&t.getComputedStyle(e,"").pointerEvents==="auto";r.removeChild(e);return!!i}return!1}(),o=i?"touchstart":"mousedown",u=i?"touchmove":"mousemove",a=i?"touchend":"mouseup";eCancel=i?"touchcancel":"mouseup";var f={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",expandBtnHTML:'<button data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20};l.prototype={init:function(){var n=this;n.reset();n.el.data("nestable-group",this.options.group);n.placeEl=e('<div class="'+n.options.placeClass+'"/>');e.each(this.el.find(n.options.itemNodeName),function(t,r){n.setParent(e(r))});n.el.on("click","button",function(t){if(n.dragEl||!i&&t.button!==0)return;var r=e(t.currentTarget),s=r.data("action"),o=r.parent(n.options.itemNodeName);s==="collapse"&&n.collapseItem(o);s==="expand"&&n.expandItem(o)});var r=function(t){var r=e(t.target);if(!r.hasClass(n.options.handleClass)){if(r.closest("."+n.options.noDragClass).length)return;r=r.closest("."+n.options.handleClass)}if(!r.length||n.dragEl||!i&&t.button!==0||i&&t.touches.length!==1)return;t.preventDefault();n.dragStart(i?t.touches[0]:t)},s=function(e){if(n.dragEl){e.preventDefault();n.dragMove(i?e.touches[0]:e)}},f=function(e){if(n.dragEl){e.preventDefault();n.dragStop(i?e.touches[0]:e)}};if(i){n.el[0].addEventListener(o,r,!1);t.addEventListener(u,s,!1);t.addEventListener(a,f,!1);t.addEventListener(eCancel,f,!1)}else{n.el.on(o,r);n.w.on(u,s);n.w.on(a,f)}},serialize:function(){var t,n=0,r=this;step=function(t,n){var i=[],s=t.children(r.options.itemNodeName);s.each(function(){var t=e(this),s=e.extend({},t.data()),o=t.children(r.options.listNodeName);o.length&&(s.children=step(o,n+1));i.push(s)});return i};t=step(r.el.find(r.options.listNodeName).first(),n);return t},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0};this.moving=!1;this.dragEl=null;this.dragRootEl=null;this.dragDepth=0;this.hasNewRoot=!1;this.pointEl=null},expandItem:function(e){e.removeClass(this.options.collapsedClass);e.children('[data-action="expand"]').hide();e.children('[data-action="collapse"]').show();e.children(this.options.listNodeName).show()},collapseItem:function(e){var t=e.children(this.options.listNodeName);if(t.length){e.addClass(this.options.collapsedClass);e.children('[data-action="collapse"]').hide();e.children('[data-action="expand"]').show();e.children(this.options.listNodeName).hide()}},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(e(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(e(this))})},setParent:function(t){if(t.children(this.options.listNodeName).length){t.prepend(e(this.options.expandBtnHTML));t.prepend(e(this.options.collapseBtnHTML))}t.children('[data-action="expand"]').hide()},unsetParent:function(e){e.removeClass(this.options.collapsedClass);e.children("[data-action]").remove();e.children(this.options.listNodeName).remove()},dragStart:function(t){var i=this.mouse,s=e(t.target),o=s.closest(this.options.itemNodeName);this.placeEl.css("height",o.height());i.offsetX=t.offsetX!==r?t.offsetX:t.pageX-s.offset().left;i.offsetY=t.offsetY!==r?t.offsetY:t.pageY-s.offset().top;i.startX=i.lastX=t.pageX;i.startY=i.lastY=t.pageY;this.dragRootEl=this.el;this.dragEl=e(n.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass);this.dragEl.css("width",o.width());o.after(this.placeEl);o[0].parentNode.removeChild(o[0]);o.appendTo(this.dragEl);e(n.body).append(this.dragEl);this.dragEl.css({left:t.pageX-i.offsetX,top:t.pageY-i.offsetY});var u,a,f=this.dragEl.find(this.options.itemNodeName);for(u=0;u<f.length;u++){a=e(f[u]).parents(this.options.listNodeName).length;a>this.dragDepth&&(this.dragDepth=a)}},dragStop:function(e){var t=this.dragEl.children(this.options.itemNodeName).first();t[0].parentNode.removeChild(t[0]);this.placeEl.replaceWith(t);this.dragEl.remove();this.el.trigger("change");this.hasNewRoot&&this.dragRootEl.trigger("change");this.reset()},dragMove:function(r){var i,o,u,a,f,l=this.options,c=this.mouse;this.dragEl.css({left:r.pageX-c.offsetX,top:r.pageY-c.offsetY});c.lastX=c.nowX;c.lastY=c.nowY;c.nowX=r.pageX;c.nowY=r.pageY;c.distX=c.nowX-c.lastX;c.distY=c.nowY-c.lastY;c.lastDirX=c.dirX;c.lastDirY=c.dirY;c.dirX=c.distX===0?0:c.distX>0?1:-1;c.dirY=c.distY===0?0:c.distY>0?1:-1;var h=Math.abs(c.distX)>Math.abs(c.distY)?1:0;if(!c.moving){c.dirAx=h;c.moving=!0;return}if(c.dirAx!==h){c.distAxX=0;c.distAxY=0}else{c.distAxX+=Math.abs(c.distX);c.dirX!==0&&c.dirX!==c.lastDirX&&(c.distAxX=0);c.distAxY+=Math.abs(c.distY);c.dirY!==0&&c.dirY!==c.lastDirY&&(c.distAxY=0)}c.dirAx=h;if(c.dirAx&&c.distAxX>=l.threshold){c.distAxX=0;u=this.placeEl.prev(l.itemNodeName);if(c.distX>0&&u.length&&!u.hasClass(l.collapsedClass)){i=u.find(l.listNodeName).last();f=this.placeEl.parents(l.listNodeName).length;if(f+this.dragDepth<=l.maxDepth)if(!i.length){i=e("<"+l.listNodeName+"/>").addClass(l.listClass);i.append(this.placeEl);u.append(i);this.setParent(u)}else{i=u.children(l.listNodeName).last();i.append(this.placeEl)}}if(c.distX<0){a=this.placeEl.next(l.itemNodeName);if(!a.length){o=this.placeEl.parent();this.placeEl.closest(l.itemNodeName).after(this.placeEl);o.children().length||this.unsetParent(o.parent())}}}var p=!1;s||(this.dragEl[0].style.visibility="hidden");this.pointEl=e(n.elementFromPoint(r.pageX-n.body.scrollLeft,r.pageY-(t.pageYOffset||n.documentElement.scrollTop)));s||(this.dragEl[0].style.visibility="visible");this.pointEl.hasClass(l.handleClass)&&(this.pointEl=this.pointEl.parent(l.itemNodeName));if(this.pointEl.hasClass(l.emptyClass))p=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(l.itemClass))return;var d=this.pointEl.closest("."+l.rootClass),v=this.dragRootEl.data("nestable-id")!==d.data("nestable-id");if(!c.dirAx||v||p){if(v&&l.group!==d.data("nestable-group"))return;f=this.dragDepth-1+this.pointEl.parents(l.listNodeName).length;if(f>l.maxDepth)return;var m=r.pageY<this.pointEl.offset().top+this.pointEl.height()/2;o=this.placeEl.parent();if(p){i=e(n.createElement(l.listNodeName)).addClass(l.listClass);i.append(this.placeEl);this.pointEl.replaceWith(i)}else m?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl);o.children().length||this.unsetParent(o.parent());this.dragRootEl.find(l.itemNodeName).length||this.dragRootEl.append('<div class="'+l.emptyClass+'"/>');if(v){this.hasNewRoot=!0;this.dragRootEl=d}}}};e.fn.nestable=function(t){var n=this,r=this;n.each(function(){var n=e(this).data("nestable");if(!n){e(this).data("nestable",new l(this,t));e(this).data("nestable-id",(new Date).getTime())}else typeof t=="string"&&typeof n[t]=="function"&&(r=n[t]())});return r||n}})(window.jQuery||window.Zepto,window,document);(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)})(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)};e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1];i=f+"-"+t;if(!r){r=n;n=e.Widget}e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)};e[f]=e[f]||{};s=e[f][t];o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)};e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]});u=new n;u.options=e.widget.extend({},u.options);e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;this._super=e;this._superApply=i;s=r.apply(this,arguments);this._super=t;this._superApply=n;return s}}()});o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i});if(s){e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)});delete s._childConstructors}else n._childConstructors.push(o);e.widget.bridge(t,o)};e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s]){a=i[s][u];i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a)}return n};e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o;u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t){f=r&&r.jquery?f.pushStack(r.get()):r;return!1}}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))});return f}};e.Widget=function(){};e.Widget._childConstructors=[];e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0];this.element=e(r);this.uuid=n++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=e.widget.extend({},this.options,this._getCreateOptions(),t);this.bindings=e();this.hoverable=e();this.focusable=e();if(r!==this){e.data(r,this.widgetFullName,this);this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}});this.document=e(r.style?r.ownerDocument:r.document||r);this.window=e(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={};s=n.split(".");n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++){o[s[u]]=o[s[u]]||{};o=o[s[u]]}n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}this._setOptions(i);return this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;if(typeof t!="boolean"){r=n;n=t;t=!1}if(!r){r=n;n=this.element;i=this.widget()}else{n=i=e(n);this.bindings=this.bindings.add(n)}e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{};n=e.Event(n);n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();n.target=this.element[0];s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);this.element.trigger(n,r);return!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}};e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{};typeof i=="number"&&(i={duration:i});o=!e.isEmptyObject(i);i.complete=s;i.delay&&r.delay(i.delay);o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t]();s&&s.call(r[0]);n()})}})});(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)})(function(e){"use strict";e.support.xhrFileUpload=!!window.XMLHttpRequestUpload&&!!window.FileReader;e.support.xhrFormDataFileUpload=!!window.FormData;e.propHooks.elements={get:function(t){return e.nodeName(t,"form")?e.grep(t.elements,function(t){return!e.nodeName(t,"input")||t.type!=="file"}):null}};e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+(new Date);this.loaded=0;this.bitrate=0;this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n){this.bitrate=(t-this.loaded)*(1e3/r)*8;this.loaded=t;this.timestamp=e}return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;if(typeof t.formData=="function")return t.formData(t.form);if(e.isArray(t.formData))return t.formData;if(t.formData){n=[];e.each(t.formData,function(e,t){n.push({name:e,value:t})});return n}return[]},_getTotal:function(t){var n=0;e.each(t,function(e,t){n+=t.size||1});return n},_onProgress:function(e,t){if(e.lengthComputable){var n=+(new Date),r,i;if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n;r=t.total||this._getTotal(t.files);i=parseInt(e.loaded/e.total*(t.chunkSize||r),10)+(t.uploadedBytes||0);this._loaded+=i-(t.loaded||t.uploadedBytes||0);t.lengthComputable=!0;t.loaded=i;t.total=r;t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval);this._trigger("progress",e,t);this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(n,this._loaded,t.bitrateInterval)})}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();if(r.upload){e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable;e.loaded=r.loaded;e.total=r.total;n._onProgress(e,t)});t.xhr=function(){return r}}},_initXHRData:function(t){var n,r=t.files[0],i=t.multipart||!e.support.xhrFileUpload,s=t.paramName[0];t.headers=t.headers||{};t.contentRange&&(t.headers["Content-Range"]=t.contentRange);if(!i){t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"';t.contentType=r.type;t.data=t.blob||r}else if(e.support.xhrFormDataFileUpload){if(t.postMessage){n=this._getFormData(t);t.blob?n.push({name:s,value:t.blob}):e.each(t.files,function(e,r){n.push({name:t.paramName[e]||s,value:r})})}else{if(t.formData instanceof FormData)n=t.formData;else{n=new FormData;e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})}if(t.blob){t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"';n.append(s,t.blob,r.name)}else e.each(t.files,function(e,r){(window.Blob&&r instanceof Blob||window.File&&r instanceof File)&&n.append(t.paramName[e]||s,r,r.name)})}t.data=n}t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){if(this._isXHRUpload(e)){if(!this._chunkedUpload(e,!0)){e.data||this._initXHRData(e);this._initProgressListener(e)}e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))}else this._initIframeSettings(e,"iframe")},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;if(!r){r=[];n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i){r.push(n);i-=1}});r.length||(r=[n.prop("name")||"files[]"])}else e.isArray(r)||(r=[r]);return r},_initFormSettings:function(t){if(!t.form||!t.form.length){t.form=e(t.fileInput.prop("form"));t.form.length||(t.form=e(this.options.fileInput.prop("form")))}t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);this._initFormSettings(n);this._initDataSettings(n);return n},_enhancePromise:function(e){e.success=e.done;e.error=e.fail;e.complete=e.always;return e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();n=n||this.options.context||s;t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r);s.abort=i.promise;return this._enhancePromise(s)},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes=t.uploadedBytes||0,u=t.maxChunkSize||s,a=i.slice||i.webkitSlice||i.mozSlice,f=e.Deferred(),l=f.promise(),c,h;if(!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data)return!1;if(n)return!0;if(o>=s){i.error="Uploaded bytes exceed file size";return this._getXHRPromise(!1,t.context,[null,"error",i.error])}h=function(){var n=e.extend({},t);n.blob=a.call(i,o,o+u,i.type);n.chunkSize=n.blob.size;n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s;r._initXHRData(n);r._initProgressListener(n);c=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize;(!n.loaded||n.loaded<n.total)&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n);t.uploadedBytes=n.uploadedBytes=o;n.result=i;n.textStatus=u;n.jqXHR=a;r._trigger("chunkdone",null,n);r._trigger("chunkalways",null,n);o<s?h():f.resolveWith(n.context,[i,u,a])}).fail(function(e,t,i){n.jqXHR=e;n.textStatus=t;n.errorThrown=i;r._trigger("chunkfail",null,n);r._trigger("chunkalways",null,n);f.rejectWith(n.context,[e,t,i])})};this._enhancePromise(l);l.abort=function(){return c.abort()};h();return l},_beforeSend:function(e,t){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer}this._active+=1;this._loaded+=t.uploadedBytes||0;this._total+=this._getTotal(t.files)},_onDone:function(t,n,r,i){if(!this._isXHRUpload(i)||!i.loaded||i.loaded<i.total){var s=this._getTotal(i.files)||1;this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:s,total:s}),i)}i.result=t;i.textStatus=n;i.jqXHR=r;this._trigger("done",null,i)},_onFail:function(e,t,n,r){r.jqXHR=e;r.textStatus=t;r.errorThrown=n;this._trigger("fail",null,r);if(r.recalculateProgress){this._loaded-=r.loaded||r.uploadedBytes||0;this._total-=r.total||this._getTotal(r.files)}},_onAlways:function(e,t,n,r){this._active-=1;this._trigger("always",null,r);if(this._active===0){this._trigger("stop");this._loaded=this._total=0;this._bitrateTimer=null}},_onSend:function(t,n){var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){r._sending+=1;a._bitrateTimer=new r._BitrateTimer;i=i||((s||r._trigger("send",t,a)===!1)&&r._getXHRPromise(!1,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._sending-=1;r._onAlways(e,t,n,a);if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift(),s;while(i){s=i.state?i.state()==="pending":!i.isRejected();if(s){i.resolve();break}i=r._slots.shift()}}});return i};this._beforeSend(t,a);if(this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(this.options.limitConcurrentUploads>1){o=e.Deferred();this._slots.push(o);u=o.pipe(f)}else u=this._sequence=this._sequence.pipe(f,f);u.abort=function(){s=[undefined,"abort","abort"];if(!i){o&&o.rejectWith(a.context,s);return f()}return i.abort()};return this._enhancePromise(u)}return f()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=s.limitMultiFileUploads,u=this._getParamName(s),a,f,l,c;if(!s.singleFileUploads&&!o||!this._isXHRUpload(s)){l=[n.files];a=[u]}else if(!s.singleFileUploads&&o){l=[];a=[];for(c=0;c<n.files.length;c+=o){l.push(n.files.slice(c,c+o));f=u.slice(c,c+o);f.length||(f=u);a.push(f)}}else a=u;n.originalFiles=n.files;e.each(l||n.files,function(s,o){var u=e.extend({},n);u.files=l?o:[o];u.paramName=a[s];u.submit=function(){u.jqXHR=this.jqXHR=r._trigger("submit",t,this)!==!1&&r._onSend(t,this);return this.jqXHR};i=r._trigger("add",t,u);return i});return i},_replaceFileInput:function(t){var n=t.clone(!0);e("<form></form>").append(n)[0].reset();t.after(n).detach();e.cleanData(t.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(e,r){return r===t[0]?n[0]:r});t[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t);i.resolve([e])},o;n=n||"";if(t.isFile)if(t._file){t._file.relativePath=n;i.resolve(t._file)}else t.file(function(e){e.relativePath=n;i.resolve(e)},s);else if(t.isDirectory){o=t.createReader();o.readEntries(function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},s)}else i.resolve([]);return i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;if(e.webkitGetAsEntry){t=e.webkitGetAsEntry();t&&(t._file=e.getAsFile());return t}return e.getAsEntry()})
):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}else r[0].name===undefined&&r[0].fileName&&e.each(r,function(e,t){t.name=t.fileName;t.size=t.fileSize});return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(e){r.files=e;n.options.replaceFileInput&&n._replaceFileInput(r.fileInput);n._trigger("change",t,r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.originalEvent.clipboardData,r=n&&n.items||[],i={files:[]};e.each(r,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&i.files.push(n)});if(this._trigger("paste",t,i)===!1||this._onAdd(t,i)===!1)return!1},_onDrop:function(e){var t=this,n=e.dataTransfer=e.originalEvent.dataTransfer,r={};n&&n.files&&n.files.length&&e.preventDefault();this._getDroppedFiles(n).always(function(n){r.files=n;t._trigger("drop",e,r)!==!1&&t._onAdd(e,r)})},_onDragOver:function(t){var n=t.dataTransfer=t.originalEvent.dataTransfer;if(this._trigger("dragover",t)===!1)return!1;if(n&&e.inArray("Files",n.types)!==-1){n.dropEffect="copy";t.preventDefault()}},_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop});this._on(this.options.pasteZone,{paste:this._onPaste})}this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._refreshOptionsList)!==-1;r&&this._destroyEventHandlers();this._super(t,n);if(r){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput));t.dropZone instanceof e||(t.dropZone=e(t.dropZone));t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data());this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers()},_destroy:function(){this._destroyEventHandlers()},add:function(t){var n=this;if(!t||this.options.disabled)return;if(t.fileInput&&!t.files)this._getFileInputFiles(t.fileInput).always(function(e){t.files=e;n._onAdd(null,t)});else{t.files=e.makeArray(t.files);this._onAdd(null,t)}},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;i.abort=function(){o=!0;if(s)return s.abort();r.reject(null,"abort","abort");return i};this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;t.files=e;s=n._onSend(null,t).then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})});return this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});